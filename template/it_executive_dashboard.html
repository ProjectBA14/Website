<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Executive Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='it-dash-style.css') }}">
    <style>
        /* Styles for the page */
        .it-executive-dashboard {
            width: 80%;
            margin: 40px auto;
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        form label {
            display: block;
            margin-bottom: 10px;
        }

        form select, form button, input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
        }

        form button {
            background-color: #4CAF50;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        form button:hover {
            background-color: #3e8e41;
        }

        .filter-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        .filter-container select, .filter-container input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .navigation-bar {
            background-color: #333;
            overflow: hidden;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .navigation-bar a {
            float: left;
            display: block;
            color: #f2f2f2;
            text-align: center;
            padding: 14px 20px;
            text-decoration: none;
            font-size: 17px;
        }

        .navigation-bar a:hover {
            background-color: #ddd;
            color: black;
        }

        .logout-btn {
            float: right;
        }
    </style>
</head>
<body>
    <div class="navigation-bar">
        {% if user_role == 'admin' %}
            <a href="{{ url_for('admin_dashboard') }}">Admin Dashboard</a>
            <a href="{{ url_for('admin_tasks') }}">Admin Tasks</a>
            <a href="{{ url_for('ticket_history') }}">Admin History</a>
        {% elif user_role == 'it_executive' %}
            <a href="{{ url_for('it_executive_dashboard') }}">Dashboard</a>
            <a href="{{ url_for('profile') }}">Profile</a>
            <a href="{{ url_for('ticket_history') }}">Ticket History</a>
        {% else %}
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('homepage') }}">Profile</a>
            <a href="{{ url_for('ticket_history') }}">Ticket History</a>
        {% endif %}
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>

    <div class="it-executive-dashboard">
        <h1>IT Executive Dashboard</h1>

        <!-- Filter for Open Tickets -->
        <div class="filter-container">
            <input type="text" id="openSearchInput" placeholder="Search Open Tickets...">
            <select id="openProductFilter">
                <option value="">Filter by Product</option>
                <option value="projector">Projector</option>
                <option value="printer">Printer</option>
                <option value="scanner">Scanner</option>
                <option value="network-connectivity">Network / Connectivity</option>
                <option value="laptop">Laptop</option>
                <option value="desktop">Desktop</option>
            </select>
            <select id="openPriorityFilter">
                <option value="">Filter by Priority</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
            </select>
        </div>

        <!-- Open Tickets Section -->
        <h2>Open Tickets</h2>
        <table id="open-tickets-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Priority</th>
                    <th>Product</th>
                    <th>Building</th>
                    <th>Room</th>
                    <th>Created At</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in unassigned_tickets %}
                <tr class="open-ticket-row">
                    <td>{{ ticket.title }}</td>
                    <td>{{ ticket.description }}</td>
                    <td>{{ ticket.priority }}</td>
                    <td>{{ ticket.product }}</td>
                    <td>{{ ticket.building }}</td>
                    <td>{{ ticket.room }}</td>
                    <td>{{ ticket.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('it_executive_dashboard') }}">
                            <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
                            <button type="submit" class="btn-accept">Accept</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Filter for Assigned Tickets -->
        <div class="filter-container">
            <input type="text" id="assignedSearchInput" placeholder="Search Assigned Tickets...">
            <select id="assignedProductFilter">
                <option value="">Filter by Product</option>
                <option value="projector">Projector</option>
                <option value="printer">Printer</option>
                <option value="scanner">Scanner</option>
                <option value="network-connectivity">Network / Connectivity</option>
                <option value="laptop">Laptop</option>
                <option value="desktop">Desktop</option>
            </select>
            <select id="assignedPriorityFilter">
                <option value="">Filter by Priority</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
            </select>
        </div>

        <!-- Assigned Tickets Section -->
        <h2>Your Assigned Tickets</h2>
        <table id="assigned-tickets-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Assigned to</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Product</th>
                    <th>Issue</th>
                    <th>Building</th>
                    <th>Room</th>
                    <th>Created At</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in assigned_tickets %}
                <tr class="assigned-ticket-row">
                    <td>{{ ticket.title }}</td>
                    <td>{{ ticket.description }}</td>
                    <td>{{ ticket.assigned_to_display }}</td>
                    <td>{{ ticket.status }}</td>
                    <td>{{ ticket.priority }}</td>
                    <td>{{ ticket.product }}</td>
                    <td>{{ ticket.issue }}</td>
                    <td>{{ ticket.building }}</td>
                    <td>{{ ticket.room }}</td>
                    <td>{{ ticket.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('it_executive_dashboard') }}">
                            <input type="hidden" name="ticket-id" value="{{ ticket.id }}">
                            <select name="ticket-status">
                                <option value="in-progress" {% if ticket.status == 'In Progress' %} selected {% endif %}>In Progress</option>
                                <option value="resolved" {% if ticket.status == 'Resolved' %} selected {% endif %}>Resolved</option>
                            </select>
                            <input type="text" name="progress-note" placeholder="Progress note (optional)">
                            <button type="submit" name="update-status">Update Status</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
// Separate filter systems for open tickets and assigned tickets
document.getElementById('openSearchInput').addEventListener('input', filterOpenTickets);
document.getElementById('openProductFilter').addEventListener('change', filterOpenTickets);
document.getElementById('openPriorityFilter').addEventListener('change', filterOpenTickets);

document.getElementById('assignedSearchInput').addEventListener('input', filterAssignedTickets);
document.getElementById('assignedProductFilter').addEventListener('change', filterAssignedTickets);
document.getElementById('assignedPriorityFilter').addEventListener('change', filterAssignedTickets);

function filterOpenTickets() {
    let searchValue = document.getElementById('openSearchInput').value.toLowerCase().trim();
    let productFilter = document.getElementById('openProductFilter').value.toLowerCase();
    let priorityFilter = document.getElementById('openPriorityFilter').value.toLowerCase();

    let openTicketRows = document.querySelectorAll('.open-ticket-row');
    filterTable(openTicketRows, searchValue, productFilter, priorityFilter);
}

function filterAssignedTickets() {
    let searchValue = document.getElementById('assignedSearchInput').value.toLowerCase().trim();
    let productFilter = document.getElementById('assignedProductFilter').value.toLowerCase();
    let priorityFilter = document.getElementById('assignedPriorityFilter').value.toLowerCase();

    let assignedTicketRows = document.querySelectorAll('.assigned-ticket-row');
    filterTable(assignedTicketRows, searchValue, productFilter, priorityFilter);
}

function filterTable(rows, searchValue, productFilter, priorityFilter) {
    rows.forEach(row => {
        let text = row.textContent.toLowerCase();
        let product = row.cells[3].textContent.toLowerCase().trim();
        let priority = row.cells[2].textContent.toLowerCase().trim();

        let matchesSearch = text.includes(searchValue);
        let matchesProduct = !productFilter || product === productFilter;
        let matchesPriority = !priorityFilter || priority === priorityFilter;

        if (matchesSearch && matchesProduct && matchesPriority) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}
</script>
</body>
</html>
