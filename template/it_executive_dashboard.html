<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Executive Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script defer src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>
    <h1>IT Executive Dashboard</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <h2>Assigned Tickets</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>Description</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Assigned To</th>
            <th>Actions</th>
        </tr>
        {% for ticket in assigned_tickets %}
        <tr>
            <td>{{ ticket.id }}</td>
            <td>{{ ticket.description }}</td>
            <td>{{ ticket.priority }}</td>
            <td>{{ ticket.status }}</td>
            <td>{{ ticket.assigned_to_display }}</td>
            <td>
                <form method="post" name="update-priority">
                    <input type="hidden" name="ticket-id" value="{{ ticket.id }}">
                    <select name="ticket-priority">
                        <option value="Low" {% if ticket.priority == 'Low' %}selected{% endif %}>Low</option>
                        <option value="Medium" {% if ticket.priority == 'Medium' %}selected{% endif %}>Medium</option>
                        <option value="High" {% if ticket.priority == 'High' %}selected{% endif %}>High</option>
                    </select>
                    <button type="submit" name="update-priority">Update Priority</button>
                </form>

                <form method="post" name="update-status">
                    <input type="hidden" name="ticket-id" value="{{ ticket.id }}">
                    <select name="ticket-status">
                        <option value="Open" {% if ticket.status == 'Open' %}selected{% endif %}>Open</option>
                        <option value="In Progress" {% if ticket.status == 'In Progress' %}selected{% endif %}>In Progress</option>
                        <option value="Closed" {% if ticket.status == 'Closed' %}selected{% endif %}>Closed</option>
                    </select>
                    <button type="submit" name="update-status">Update Status</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    <h2>Unassigned Tickets</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>Description</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
        {% for ticket in unassigned_tickets %}
        <tr>
            <td>{{ ticket.id }}</td>
            <td>{{ ticket.description }}</td>
            <td>{{ ticket.priority }}</td>
            <td>{{ ticket.status }}</td>
            <td>
                <form method="post" name="accept-ticket">
                    <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
                    <button type="submit">Accept Ticket</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
</body>
<script>
    document.addEventListener("DOMContentLoaded", function () {
    // Auto-hide flash messages after 3 seconds
    setTimeout(() => {
        document.querySelectorAll(".flash").forEach(msg => {
            msg.style.display = "none";
        });
    }, 3000);

    // Confirm before updating priority
    document.querySelectorAll("form[name='update-priority']").forEach(form => {
        form.addEventListener("submit", function (event) {
            if (!confirm("Are you sure you want to update the ticket priority?")) {
                event.preventDefault();
            }
        });
    });

    // Confirm before updating status
    document.querySelectorAll("form[name='update-status']").forEach(form => {
        form.addEventListener("submit", function (event) {
            if (!confirm("Are you sure you want to update the ticket status?")) {
                event.preventDefault();
            }
        });
    });

    // Confirm before accepting a ticket
    document.querySelectorAll("form[name='accept-ticket']").forEach(form => {
        form.addEventListener("submit", function (event) {
            if (!confirm("Are you sure you want to accept this ticket?")) {
                event.preventDefault();
            }
        });
    });
});

</script>
</html>
